<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>[쿨타이드 MBTI] 이불이 나보다 성격이 확실하네?</title>
  <link rel="stylesheet" href="style/page.css" />
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <style>
    body.fade-out {
      opacity: 0;
      transition: opacity 0.4s ease;
    }
  </style>
</head>
<body>
  <div id="start-screen" class="start-screen">
    <img src="./assets/img/start_background.jpg" class="start-bg" alt="시작 배경" />
    <button class="start-btn" id="start-btn" type="button" aria-label="MBTI 테스트 시작하기">MBTI 테스트 시작하기</button>
  </div>
  <div class="container">
    <div class="progress-bar"><div id="progress" class="progress"></div></div>
    <div class="question-box" id="question-box"></div>
    <div class="options" id="options-box"></div>
    <button class="back-button" id="back-button" style="display:none;" type="button" aria-label="이전 질문으로">← 이전</button>
  </div>
  <div class="logo">
    <img src="https://ecimg.cafe24img.com/pg283b14366217017/eleanorco/web/upload/category/editor/2024/03/25/05dc5d6b4907ecd12de9df665366c49e.png" alt="로고">
  </div>

  <script>
    const questions = [
      {
        question: `Q1. 
        오늘 하루 끝! 집 도착하자마자 내가 찾는 건?`,
        options: [
          { text: `아무도 없는 방, 조용한 공기, 
            시원한 이불. 그냥… 쉼.`, types: ["EN", "IN"] },
          { text: `치킨 뜯고 🍗 맥주 한 모금🍺 
            에어컨 바람 쐬면서 넷플릭스 켜기`, types: ["ES", "EN"] },
          { text: `오늘도 고생했어 나야… 
            거울 앞 셀카로 하루 마무리✨`, types: ["IS"] }
        ]
      },
      {
        question: `Q2. 
        열대야 속, 이불은 어떻게 써야 제맛?`,
        options: [
          { text: `다리 한 쪽만 쏙~ 이불과 나의 거리두기`, types: ["ES", "EN"] },
          { text: `배만 딱 덮으면 안정감 + 시원함 완성`, types: ["IS"] },
          { text: `여름이어도 이불은 포근해야 잠이 옴. 
            무조건 보들보들!`, types: ["IN", "IS"] }
        ]
      },
      {
        question: `Q3. 
        여름에 지친 날, 나만의 스트레스 해소법은?`,
        options: [
          { text: `시원한 물로 샤워 후 침대에 풍덩. 
            그게 바로 힐링이지`, types: ["EN"] },
          { text: `집 밖은 위험해… 
            방콕하면서 푹 자는 게 최고`, types: ["EN"] },
          { text: `물놀이, 여행, 바닷바람! 
            신나게 뛰어놀기부터 시작!`, types: ["IS", "ES"] }
        ]
      },
      {
        question: `Q4. 
        에어컨과 나의 거리감은?`,
        options: [
          { text: `리모컨은 내 손에 항상 있음. 
            미세 조정까지 완벽하게!`, types: ["EN", "ES"] },
          { text: `직풍은 싫어… 
            벽 타고 오는 간접바람이 진짜 찐이지`, types: ["IN"] },
          { text: `선풍기 바람이 더 좋아. 
            부드럽고 조용해서`, types: ["IS", "IN"] }
        ]
      },
      {
        question: `Q5. 
        세탁 끝낸 이불 다시 깔았을 때 드는 생각은?`,
        options: [
          { text: `와.. 나 좀 멋진데? 
            방이 새집 같아`, types: ["IS", "ES"] },
          { text: `바로 얼굴 파묻기! 
            이 향기, 이 보송함.. 미쳤다`, types: ["IN"] },
          { text: `어차피 또 금방 더러워질 건데… 
            감흥 1도 없음`, types: ["EN", "ES"] }
        ]
      },
      {
        question: `Q6. 
        침대에 누운 순간, 3초 안에 스치는 생각은?`,
        options: [
          { text: `폰 충전 안 꽂았네… 
            근데 귀찮아서 그냥 누움`, types: ["EN"] },
          { text: `이불 속 = 세상에서 제일 안전한 공간`, types: ["IN", "IS"] },
          { text: `쇼츠 한 편만 보자… 
            하다가 벌써 새벽 2시`, types: ["ES"] }
        ]
      }
    ];

    let current = 0;
    const score = { EN: 0, IN: 0, ES: 0, IS: 0 };
    const answers = [];

    function updateProgress() {
      const progress = document.getElementById("progress");
      const percent = (current / questions.length) * 100;
      progress.style.width = percent + "%";
    }

    function recalculateScore() {
      score.EN = score.IN = score.ES = score.IS = 0;
      answers.forEach(typeList => {
        typeList.forEach(type => {
          if (score.hasOwnProperty(type)) {
            score[type]++;
          }
        });
      });
    }

    window.onload = () => {
      document.getElementById('start-screen').classList.add('fade-in');
    };

    document.getElementById('start-btn').onclick = () => {
      const startScreen = document.getElementById('start-screen');
      const startBtn = document.getElementById('start-btn');
      startBtn.disabled = true;
      startScreen.classList.remove('fade-in');
      void startScreen.offsetWidth;
      startScreen.classList.add('fade-out');

      setTimeout(() => {
        startScreen.style.display = 'none';
        showQuestion();
      }, 400);
    };

    function showQuestion() {
      const q = questions[current];
      const questionBox = document.getElementById("question-box");
      const optionsBox = document.getElementById("options-box");
      const backBtn = document.getElementById("back-button");

      questionBox.className = "question-box fade-in";
      optionsBox.className = "options fade-in";
      backBtn.classList.remove("fade-out");
      backBtn.classList.add("fade-in");

      questionBox.innerText = q.question;
      optionsBox.innerHTML = "";

      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.innerText = opt.text;
        btn.className = "option";
        btn.type = "button";
        btn.setAttribute("aria-label", opt.text);
        btn.onclick = () => {
          questionBox.classList.remove("fade-in");
          optionsBox.classList.remove("fade-in");
          questionBox.classList.add("fade-out");
          optionsBox.classList.add("fade-out");
          backBtn.classList.remove("fade-in");
          backBtn.classList.add("fade-out");

          setTimeout(() => {
            if (Array.isArray(opt.types)) {
              answers[current] = opt.types;
              current++;
              recalculateScore();

              if (current < questions.length) {
                updateProgress();
                showQuestion();
              } else {
                goToResult();
              }
            } else {
              alert("타입 데이터가 잘못되었습니다.");
            }
          }, 400);
        };
        optionsBox.appendChild(btn);
      });

      backBtn.style.display = current > 0 ? "inline-block" : "none";
      updateProgress();
    }

    document.getElementById("back-button").onclick = () => {
      if (current > 0) {
        current--;
        answers.pop();
        recalculateScore();
        showQuestion();
      }
    };

    function goToResult() {
      document.body.classList.add('fade-out');
      setTimeout(() => {
        const sorted = Object.entries(score).sort((a, b) => b[1] - a[1]);
        const resultType = sorted[0][0];
        localStorage.setItem('mbti_result', resultType);
        window.location.href = `result_${resultType}.html`;
      }, 400);
    }
  </script>
</body>
</html>
